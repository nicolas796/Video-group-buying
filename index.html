<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Group Buying - eStreamly</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Upper Third: Video Player -->
        <div class="video-section">
            <video id="video-player" controls playsinline autoplay loop muted crossorigin="anonymous"></video>
            <div id="loading" class="loading">Loading video...</div>
        </div>
        
        <!-- Bottom Two Thirds: Content -->
        <div class="content-section" id="main-content">
            <!-- Landing View -->
            <div id="landing-view">
                <!-- Join Box - AT THE TOP, NO SCROLLING -->
                <div class="join-box">
                    <h2>Join to unlock</h2>
                    <form id="join-form">
                        <div class="input-row">
                            <div class="input-group half">
                                <input type="tel" id="phone" placeholder="Cellphone" required>
                            </div>
                            <div class="input-group half">
                                <input type="email" id="email" placeholder="Email" required>
                            </div>
                        </div>
                        <button type="submit" class="join-btn">Unlock exclusive pricing</button>
                    </form>
                    <p class="terms-compliance">
                        By joining, you agree to our <a href="#" id="terms-link" target="_blank" rel="noopener noreferrer">Terms & Conditions</a>
                    </p>
                </div>
                
                <!-- Countdown (Limited Time Offer) -->
                <div class="countdown-section landing">
                    <p class="countdown-label">‚è∞ Limited time offer ends in:</p>
                    <div class="countdown" id="countdown-landing">
                        <span id="days-landing">00</span>d
                        <span id="hours-landing">00</span>h
                        <span id="minutes-landing">00</span>m
                        <span id="seconds-landing">00</span>s
                    </div>
                </div>
                
                <!-- Social Proof -->
                <div class="social-proof">
                    <span class="buyer-pulse"></span>
                    <span class="counter-inline"><span id="buyer-count">742</span> buyers already joined</span>
                </div>
                
                <!-- Product & Progress - Compact -->
                <div class="product-progress-compact">
                    <div class="product-mini">
                        <img id="product-img" src="" alt="Product">
                        <div class="product-mini-info">
                            <div class="product-name" id="product-name"></div>
                            <div class="price-tag">
                                <span class="initial-price" id="initial-price"></span>
                                <span class="current-price" id="current-price">$80</span>
                            </div>
                        </div>
                        <button class="info-btn" id="info-btn" onclick="toggleProductInfo()">
                            <span class="chevron">‚åÑ</span>
                        </button>
                    </div>
                    
                    <div class="progress-bar-container mini">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                    <div class="unlocked-text" id="unlocked-price"></div>
                    
                    <!-- Expandable Product Description -->
                    <div class="product-details" id="product-details">
                        <div class="details-content" id="product-details-content">
                            <!-- Content loaded dynamically from config -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Success View (Hidden initially) -->
            <div id="success-view" class="hidden">
                <!-- Share Section - MOVED TO TOP for mobile priority -->
                <div class="share-section">
                    <p>Share to unlock the best price!</p>
                    <button class="share-btn" id="share-btn" onclick="shareReferral()">
                        <span>üì§ Share with friends</span>
                    </button>
                    <p class="referral-hint">2 friends join = instant $<span id="share-best-price">20</span> price</p>
                </div>

                <div class="success-message">
                    <h2>You're in! üéâ</h2>
                    <p>Watch the price drop as more people join.</p>
                </div>

                <!-- Referral Status -->
                <div class="referral-status" id="referral-status">
                    <div class="referral-progress" id="referral-progress">
                        <p class="referral-title">üéÅ Unlock Best Price Now!</p>
                        <p class="referral-subtitle">Get <span id="referrals-needed-text">2</span> friends to join and unlock $<span id="best-price">20</span> immediately</p>
                        <div class="referral-dots" id="referral-dots-container">
                            <!-- Dots generated dynamically -->
                        </div>
                        <p class="referral-count" id="referral-count">0 of 2 referrals</p>
                    </div>
                    <div class="referral-unlocked hidden" id="referral-unlocked">
                        <p class="unlocked-title">üèÜ Best Price Unlocked!</p>
                        <p class="unlocked-price">You got $<span id="unlocked-price-value">20</span>!</p>
                    </div>
                </div>

                <!-- Progress Bar (carries over) -->
                <div class="progress-section compact">
                    <div class="product-display compact">
                        <div class="product-image small">
                            <img id="product-img-success" src="" alt="Product">
                        </div>
                        <div class="product-info">
                            <div class="product-name small" id="product-name-success"></div>
                        </div>
                        <div class="price-display compact">
                            <span class="initial-price small" id="initial-price-success"></span>
                            <span class="current-price small" id="current-price-success"></span>
                        </div>
                    </div>

                    <div class="counter small">
                        <span id="buyer-count-success">742</span> buyers already joined
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar-success"></div>
                        <div class="tier-markers" id="tier-markers-success"></div>
                    </div>

                    <div class="tier-labels" id="tier-labels-success"></div>
                </div>

                <!-- Countdown -->
                <div class="countdown-section">
                    <p class="countdown-label">Drop ends in:</p>
                    <div class="countdown" id="countdown">
                        <span id="days">00</span>d
                        <span id="hours">00</span>h
                        <span id="minutes">00</span>m
                        <span id="seconds">00</span>s
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Safari viewport fix -->
    <script>
        // Fix Safari viewport issues with virtual keyboard
        (function() {
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            
            if (isSafari) {
                // Store initial viewport height
                let vh = window.innerHeight;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                
                // Prevent viewport from resizing when keyboard appears
                window.addEventListener('resize', function() {
                    // Don't update if it's just the keyboard
                    if (document.activeElement && 
                        (document.activeElement.tagName === 'INPUT' || 
                         document.activeElement.tagName === 'TEXTAREA')) {
                        return;
                    }
                    vh = window.innerHeight;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                });
                
                // Handle input focus/blur
                document.addEventListener('focusin', function(e) {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                        // Scroll element into view smoothly
                        setTimeout(function() {
                            e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 100);
                    }
                });
            }
        })();
    </script>
    <!-- Brave browser fix for black video screen with ref= parameter -->
<script>
(function() {
    // Detect Brave browser
    function isBrave() {
        return navigator.brave && navigator.brave.isBrave ? true : false;
    }
    
    // Check if URL has ref parameter
    function hasRefParam() {
        return window.location.search.includes('ref=');
    }
    
    // Apply fix if Brave and ref param detected
    if (isBrave() && hasRefParam()) {
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('video-player');
            if (video) {
                video.classList.add('brave-fix');
                // Force a repaint to ensure the fix takes effect
                video.style.display = 'none';
                void video.offsetHeight; // Trigger reflow
                video.style.display = '';
            }
        });
    }
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="campaign-loader.js"></script>
    <script src="app.js"></script>
</body>
</html>
