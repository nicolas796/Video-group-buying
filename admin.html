<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Group Buying</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="admin-container">
        <header>
            <h1>üéØ Drop Admin</h1>
            <p>Configure your group buying campaign</p>
        </header>
        
        <!-- Campaign Selector -->
        <section class="form-section campaign-selector-section">
            <h2>üìÅ Campaign</h2>
            <div class="form-row">
                <div class="form-group three-quarters">
                    <label>Select Campaign</label>
                    <select id="campaign-selector" onchange="onCampaignSelect()">
                        <option value="">-- Select a campaign --</option>
                    </select>
                </div>
                <div class="form-group quarter">
                    <label>&nbsp;</label>
                    <button type="button" class="btn-secondary" onclick="createNewCampaign()">+ New Campaign</button>
                </div>
            </div>
            <div class="campaign-id-display" id="campaign-id-display" style="display: none;">
                <span class="label">Campaign ID:</span>
                <code id="current-campaign-id"></code>
                <span class="url-hint" id="campaign-url-hint"></span>
            </div>
        </section>
        
        <form id="admin-form" style="display: none;">
            <!-- Stats Section - AT THE TOP -->
            <section class="form-section stats">
                <h2>üìä Live Stats</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <span class="stat-label">Total Buyers</span>
                        <span class="stat-value" id="stat-total-buyers">-</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Real Participants</span>
                        <span class="stat-value" id="stat-real">-</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Current Price</span>
                        <span class="stat-value" id="stat-current-price">-</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-label">Time Left</span>
                        <span class="stat-value" id="stat-time-left">-</span>
                    </div>
                </div>
                <button type="button" class="btn-secondary" onclick="viewParticipants()">üë• View Participants</button>
                <button type="button" class="btn-secondary" onclick="downloadParticipants()" id="download-btn" style="margin-left: 10px;">üì• Download Excel</button>
            </section>
            
            <!-- Product Section -->
            <section class="form-section">
                <h2>üì¶ Product</h2>
                <div class="form-group">
                    <label>Product Image URL</label>
                    <input type="url" id="product-image" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="product-name" placeholder="Product name">
                </div>
                <div class="form-group">
                    <label>Short Description (HTML supported)</label>
                    <textarea id="product-description" rows="5" placeholder="e.g., <h4>Product Details</h4><p>Description...</p>"></textarea>
                </div>
            </section>
            
            <!-- Video Section -->
            <section class="form-section">
                <h2>üé• Video</h2>
                <div class="form-group">
                    <label>m3u8 Video URL</label>
                    <input type="url" id="video-source" placeholder="https://.../playlist.m3u8">
                </div>
            </section>

            <!-- Checkout Section -->
            <section class="form-section">
                <h2>üõí Checkout</h2>
                <div class="form-group">
                    <label>Checkout URL</label>
                    <input type="url" id="checkout-url" placeholder="https://shop.example.com/product">
                    <small>Product purchase URL that buyers will be directed to</small>
                </div>
            </section>

            <!-- Terms & Conditions Section -->
            <section class="form-section">
                <h2>üìã Legal</h2>
                <div class="form-group">
                    <label>Terms & Conditions URL</label>
                    <input type="url" id="terms-url" placeholder="https://example.com/terms">
                    <small>Link to your Terms & Conditions page. Displayed on the landing page below the registration form.</small>
                </div>
            </section>

            <!-- Twilio SMS Section -->
            <section class="form-section">
                <h2>üì± Twilio SMS</h2>
                <div class="form-group checkbox">
                    <label>
                        <input type="checkbox" id="twilio-enabled">
                        Enable SMS notifications
                    </label>
                </div>
                <div class="form-group">
                    <label>Account SID</label>
                    <input type="text" id="twilio-sid" placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                <div class="form-group">
                    <label>Auth Token</label>
                    <input type="password" id="twilio-token" placeholder="your_auth_token">
                </div>
                <div class="form-group">
                    <label>Twilio Phone Number</label>
                    <input type="text" id="twilio-number" placeholder="+1234567890">
                    <small>Must be a Twilio number with SMS capability</small>
                </div>
                <div class="form-group">
                    <label>Your Domain (for referral links)</label>
                    <input type="text" id="domain" placeholder="https://your-domain.com">
                    <small>Used in SMS messages for referral links</small>
                </div>
            </section>
            
            <!-- Pricing Section -->
            <section class="form-section">
                <h2>üí∞ Pricing</h2>
                <div class="form-row">
                    <div class="form-group half">
                        <label>Initial Price ($)</label>
                        <input type="number" id="initial-price" min="0" step="0.01">
                    </div>
                    <div class="form-group half">
                        <label>Initial Buyers Count</label>
                        <input type="number" id="initial-buyers" min="0">
                    </div>
                </div>
                
                <h3>Price Tiers</h3>
                <div class="tier-header">
                    <span class="tier-header-label">#</span>
                    <span class="tier-header-label">Buyers</span>
                    <span class="tier-header-label">Price ($)</span>
                    <span class="tier-header-label">Coupon Code</span>
                    <span class="tier-header-label">Actions</span>
                </div>
                <div id="price-tiers">
                    <!-- Dynamic tier rows -->
                </div>
                <button type="button" class="btn-secondary" onclick="addTier()">+ Add Tier</button>
            </section>
            
            <!-- Referral Section -->
            <section class="form-section">
                <h2>üéÅ Referral Rewards</h2>
                <div class="form-group">
                    <label>Referrals Needed to Unlock Best Price</label>
                    <input type="number" id="referrals-needed" min="1" max="10" value="2">
                    <small>How many friends must join for the referrer to instantly unlock the lowest price</small>
                </div>
            </section>
            
            <!-- Countdown Section -->
            <section class="form-section">
                <h2>‚è∞ Countdown</h2>
                <div class="form-group">
                    <label>End Date & Time</label>
                    <input type="datetime-local" id="countdown-end">
                    <small>Times are in your local timezone</small>
                </div>
            </section>
            
            <!-- Actions -->
            <div class="form-actions">
                <button type="submit" class="btn-primary">üíæ Save Changes</button>
                <button type="button" class="btn-secondary" onclick="resetForm()">‚Ü∫ Reset</button>
                <button type="button" class="btn-danger" onclick="deleteCampaign()">üóëÔ∏è Delete Campaign</button>
            </div>
        </form>
        
        <div id="no-campaign" style="display: none; text-align: center; padding: 40px;">
            <p style="color: #888; margin-bottom: 20px;">Select a campaign above or create a new one to get started.</p>
        </div>
        
        <div id="toast" class="toast"></div>
    </div>
    
    <!-- Participants Modal -->
    <div id="participants-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Participants</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <table id="participants-table">
                    <thead>
                        <tr>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Referral Code</th>
                            <th>Referred By</th>
                            <th>Campaign</th>
                            <th>Joined</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script src="admin.js"></script>
</body>
</html>